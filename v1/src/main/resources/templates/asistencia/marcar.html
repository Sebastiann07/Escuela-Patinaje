<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="fragments/head :: head"></head>
<body>
    <!-- NAVBAR -->
    <header th:replace="fragments/navbar :: navbar"></header>

    <main class="container section-padding" style="margin-top: 40px; margin-bottom: 60px;">
        <div class="container-fluid">
            <!-- ENCABEZADO -->
            <div class="row mb-4">
                <div class="col-lg-12">
                    <div class="card border-0 shadow-sm" style="border-radius: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="card-body p-5">
                            <h1 class="mb-2">
                                <i class="bi bi-pencil-square"></i> Marcar Asistencia
                            </h1>
                            <p class="mb-2 lead" th:text="'Clase: ' + ${clase?.nombre}"></p>
                            <small th:if="${clase}">
                                <i class="bi bi-calendar-event"></i> <span th:text="${clase.dia}"></span> | 
                                <i class="bi bi-clock"></i> <span th:text="${clase.horaInicio} + ' - ' + ${clase.horaFin}"></span> | 
                                <i class="bi bi-people"></i> <span th:text="'Alumnos inscritos: ' + ${clase.inscritos}"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TABLA DE ASISTENCIA -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="card border-0 shadow-sm" style="border-radius: 12px;">
                        <div class="card-header bg-primary text-white" style="border-radius: 12px 12px 0 0;">
                            <h5 class="mb-0">
                                <i class="bi bi-list-check"></i> Registrar Asistencia
                            </h5>
                        </div>

                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 5%;">
                                                <i class="bi bi-list"></i>
                                            </th>
                                            <th style="width: 50%;">
                                                <i class="bi bi-person"></i> Alumno
                                            </th>
                                            <th style="width: 30%;">
                                                <i class="bi bi-check-circle"></i> Estado
                                            </th>
                                            <th style="width: 15%; text-align: center;">
                                                <i class="bi bi-floppy"></i> Acción
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="alumno, iterStat : ${alumnos}">
                                            <td class="text-muted" th:text="${iterStat.count}"></td>
                                            <td>
                                                <strong th:text="${alumno.name}"></strong>
                                                <br>
                                                <small class="text-muted" th:text="${alumno.email}"></small>
                                            </td>
                                            <td>
                                                <form th:action="@{/asistencia/guardar}" method="post" class="d-flex gap-2 align-items-center">
                                                    <input type="hidden" name="claseId" th:value="${clase.id}">
                                                    <input type="hidden" name="alumnoId" th:value="${alumno.id}">

                                                    <select name="estado" class="form-select form-select-sm" style="min-width: 150px;">
                                                        <option value="" selected>-- Seleccionar --</option>
                                                        <option value="ASISTIÓ">✓ Asistió</option>
                                                        <option value="FALLÓ">✗ Falló</option>
                                                        <option value="JUSTIFICÓ">⊘ Justificó</option>
                                                    </select>

                                                    <button type="submit" class="btn btn-sm btn-success" title="Guardar asistencia">
                                                        <i class="bi bi-check-lg"></i>
                                                    </button>
                                                </form>
                                            </td>
                                            <td class="text-center">
                                                <a href="#" class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="Ver historial">
                                                    <i class="bi bi-graph-up"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- RESUMEN -->
                            <div class="alert alert-info mt-4" role="alert">
                                <i class="bi bi-info-circle"></i>
                                Total de alumnos: <strong th:text="${alumnos.size()}"></strong> | 
                                Inscritos en clase: <strong th:text="${clase.inscritos}"></strong>
                            </div>
                        </div>

                        <div class="card-footer bg-light" style="border-radius: 0 0 12px 12px;">
                            <div class="d-flex gap-2 justify-content-between">
                                <a href="/asistencia" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left"></i> Volver a Clases
                                </a>
                                <div>
                                    <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                                        <i class="bi bi-arrow-clockwise"></i> Actualizar
                                    </button>
                                    <a href="/" class="btn btn-outline-primary">
                                        <i class="bi bi-house"></i> Inicio
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer th:replace="fragments/footer :: footer"></footer>

    <!-- SCRIPTS -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        // Tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Highlight row on select change
        document.querySelectorAll('select[name="estado"]').forEach(select => {
            select.addEventListener('change', function() {
                const row = this.closest('tr');
                if (this.value) {
                    row.style.backgroundColor = '#e8f5e9';
                } else {
                    row.style.backgroundColor = '';
                }
            });
        });
    </script>
</body>
</html>
